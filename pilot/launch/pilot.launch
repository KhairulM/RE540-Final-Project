<?xml version="1.0"?>
<launch>
    <!-- Arguments -->
    <arg name="use_llm" default="true" doc="Enable LLM agent node"/>
    <arg name="use_state_manager" default="true" doc="Enable state manager node"/>
    <arg name="use_pilot_new" default="true" doc="Enable pilot new node"/>
    
    <!-- LLM Agent Configuration -->
    <arg name="llm_model" default="gpt-4o-mini" doc="OpenAI model to use"/>
    <arg name="llm_temperature" default="0.7" doc="LLM temperature parameter"/>
    <arg name="llm_max_tokens" default="500" doc="Maximum tokens for LLM response"/>
    <arg name="enable_history" default="true" doc="Enable conversation history"/>
    
    <!-- Load parameters from yaml file -->
    <rosparam command="load" file="$(find pilot)/config/pilot_params.yaml" />
    
    <!-- LLM Agent Node -->
    <node if="$(arg use_llm)" 
          pkg="pilot" 
          type="llm_agent_node.py" 
          name="llm_agent" 
          output="screen"
          required="false">
        <param name="model" value="$(arg llm_model)"/>
        <param name="default_temperature" value="$(arg llm_temperature)"/>
        <param name="default_max_tokens" value="$(arg llm_max_tokens)"/>
        <param name="enable_history" value="$(arg enable_history)"/>
    </node>
    
    <!-- State Manager Node (must run before pilot new node) -->
    <node if="$(arg use_state_manager)" 
          pkg="pilot" 
          type="state_manager_node.py" 
          name="state_manager" 
          output="screen"
          required="false">
        <param name="rate" value="10.0"/>
    </node>
    
    <!-- Pilot New Node -->
    <node if="$(arg use_pilot_new)"
          pkg="pilot"
          type="pilot_new_node.py"
          name="pilot_node"
          output="screen"
          required="false">
        <param name="cmd_vel_topic" value="/cmd_vel" />
    </node>

</launch>
